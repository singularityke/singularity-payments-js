---
title: Configuration
description: Complete guide to configuring Singularity Payments SDK for M-Pesa integration
---

## Overview

The SDK requires M-Pesa API credentials from Safaricom's Developer Portal. Configuration is framework-agnostic and works the same across all packages.

## Basic Configuration

All M-Pesa integrations require these core credentials for STK Push:

```bash
MPESA_CONSUMER_KEY=your_consumer_key
MPESA_CONSUMER_SECRET=your_consumer_secret
MPESA_SHORTCODE=174379
MPESA_PASSKEY=bfb279f9aa9bdbcf158e97dd71a467cd2e0c893059b10f78e6b72ada1ed2c919
MPESA_ENVIRONMENT=sandbox
MPESA_CALLBACK_URL=https://yourdomain.com/api/mpesa/callback
```

### SDK Initialization

```typescript
import { MpesaClient } from "@singularity-payments/nextjs";

const client = new MpesaClient({
  consumerKey: process.env.MPESA_CONSUMER_KEY,
  consumerSecret: process.env.MPESA_CONSUMER_SECRET,
  passkey: process.env.MPESA_PASSKEY,
  shortcode: process.env.MPESA_SHORTCODE,
  environment: "sandbox",
  callbackUrl: process.env.MPESA_CALLBACK_URL,
});
```

## Getting M-Pesa Credentials

### Step 1: Create a Safaricom Developer Account

1. Go to [Safaricom Developer Portal](https://developer.safaricom.co.ke/)
2. Click **Sign Up** and create an account
3. Verify your email address
4. Log in to your account

### Step 2: Create an App

1. Navigate to **[My Apps](https://developer.safaricom.co.ke/dashboard/myapps)**
2. Click **Create Sandbox App**
3. Fill in the app details:
   - **App Name**: Your application name
   - **Description**: Brief description of your app
4. Select **Lipa Na M-Pesa (STK Push)**
5. Click **Create App**

### Step 3: Get Your Credentials

After creating your app, you'll receive:

- **Consumer Key**: Found on your app's page
- **Consumer Secret**: Found on your app's page (click to reveal)

### Sandbox Test Credentials

```bash
MPESA_CONSUMER_KEY=your_sandbox_consumer_key
MPESA_CONSUMER_SECRET=your_sandbox_consumer_secret
MPESA_PASSKEY=bfb279f9aa9bdbcf158e97dd71a467cd2e0c893059b10f78e6b72ada1ed2c919
MPESA_SHORTCODE=174379
MPESA_ENVIRONMENT=sandbox
MPESA_CALLBACK_URL=https://your-ngrok-url.ngrok.io/api/mpesa/callback
```

## Setting Up Tunneling for Development

Your callback URL must be publicly accessible. For local development, use a tunneling service:

### Using ngrok

1. Install ngrok:

```bash
npm install -g ngrok
```

2. Start your development server:

```bash
npm run dev
```

3. In a new terminal, start ngrok:

```bash
ngrok http 3000
```

4. Copy the HTTPS URL (e.g., `https://abc123.ngrok.io`)

5. Update your `.env`:

```bash
MPESA_CALLBACK_URL=https://abc123.ngrok.io/api/mpesa/callback
```

### Alternative Tunneling Services

- [Cloudflare Tunnel](https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/)
- [LocalTunnel](https://localtunnel.github.io/www/)

## Environment Variables

Create a `.env` file in your project root:

```bash
MPESA_CONSUMER_KEY=your_consumer_key
MPESA_CONSUMER_SECRET=your_consumer_secret
MPESA_PASSKEY=bfb279f9aa9bdbcf158e97dd71a467cd2e0c893059b10f78e6b72ada1ed2c919
MPESA_SHORTCODE=174379
MPESA_ENVIRONMENT=sandbox
MPESA_CALLBACK_URL=https://yourdomain.com/api/mpesa/callback
```

Add `.env` to your `.gitignore`:

```bash
.env
.env.local
.env.production
```

## Advanced Configuration

<Cards>
  <Card title="Advanced Configuration" href="/api/advanced-configuration">
    Learn about B2C, B2B, reversals, and advanced options
  </Card>
</Cards>

## Framework-Specific Integration Guides

<Cards>
  <Card title="Next.js" href="/integrations/index">
    Complete integration guide for Next.js applications
  </Card>

<Card title="Express" href="/integrations/express">
  Integration guide for Express.js applications
</Card>

<Card title="Fastify" href="/integrations/fastify">
  Integration guide for Fastify applications
</Card>

<Card title="Hono" href="/integrations/hono">
  Integration guide for Hono applications
</Card>

<Card title="Elysia" href="/integrations/elysia">
  Integration guide for Elysia applications
</Card>

<Card title="Nuxt" href="/integrations/nuxt">
  Integration guide for Nuxt applications
</Card>

  <Card title="SvelteKit" href="/integrations/sveltekit">
    Integration guide for SvelteKit applications
  </Card>
</Cards>
```
