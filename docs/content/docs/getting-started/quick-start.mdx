---
title: Quick Start
description: Get started with M-Pesa payments in your app in minutes.
---

import { Tab, Tabs } from "fumadocs-ui/components/tabs";
import { Callout } from "fumadocs-ui/components/callout";
import { Steps, Step } from "fumadocs-ui/components/steps";

## Installation

Install both the Client and Server package client package

## Server-Side

<Tabs items={["Next.js", "SvelteKit", "Nuxt", "Elysia", "Fastify", "Hono"]}>
  <Tab value="Next.js">
    <Tabs items={["npm", "pnpm", "yarn", "bun"]}>
      <Tab value="npm">
```bash
npm install @singularity-payments/nextjs
```
      </Tab>
      <Tab value="pnpm">
```bash
pnpm add @singularity-payments/nextjs
```
      </Tab>
      <Tab value="yarn">
```bash
yarn add @singularity-payments/nextjs
```
      </Tab>
      <Tab value="bun">
```bash
bun add @singularity-payments/nextjs
```
      </Tab>
    </Tabs>
  </Tab>
<Tab value="SvelteKit">
  <Tabs items={["npm", "pnpm", "yarn", "bun"]}>
    <Tab value="npm">
```bash
npm install @singularity-payments/sveltekit
```
    </Tab>
    <Tab value="pnpm">
```bash
pnpm add @singularity-payments/sveltekit
```
    </Tab>
    <Tab value="yarn">
```bash
yarn add @singularity-payments/sveltekit
```
    </Tab>
    <Tab value="bun">
```bash
bun add @singularity-payments/sveltekit
```
    </Tab>
  </Tabs>
</Tab>
<Tab value="Nuxt">
  <Tabs items={["npm", "pnpm", "yarn", "bun"]}>
    <Tab value="npm">
```bash
npm install @singularity-payments/nuxt
```
    </Tab>
    <Tab value="pnpm">
```bash
pnpm add @singularity-payments/nuxt
```
    </Tab>
    <Tab value="yarn">
```bash
yarn add @singularity-payments/nuxt
```
    </Tab>
    <Tab value="bun">
```bash
bun add @singularity-payments/nuxt
```
    </Tab>
  </Tabs>
</Tab>
<Tab value="Elysia">
  <Tabs items={["npm", "pnpm", "yarn", "bun"]}>
    <Tab value="npm">
```bash
npm install @singularity-payments/elysia
```
    </Tab>
    <Tab value="pnpm">
```bash
pnpm add @singularity-payments/elysia
```
    </Tab>
    <Tab value="yarn">
```bash
yarn add @singularity-payments/elysia
```
    </Tab>
    <Tab value="bun">
```bash
bun add @singularity-payments/elysia
```
    </Tab>
  </Tabs>
</Tab>
<Tab value="Fastify">
  <Tabs items={["npm", "pnpm", "yarn", "bun"]}>
    <Tab value="npm">
```bash
npm install @singularity-payments/fastify
```
    </Tab>
    <Tab value="pnpm">
```bash
pnpm add @singularity-payments/fastify
```
    </Tab>
    <Tab value="yarn">
```bash
yarn add @singularity-payments/fastify
```
    </Tab>
    <Tab value="bun">
```bash
bun add @singularity-payments/fastify
```
    </Tab>
  </Tabs>
</Tab>

<Tab value="Fastify">
  <Tabs items={["npm", "pnpm", "yarn", "bun"]}>
    <Tab value="npm">```bash npm install @singularity-payments/fastify ```</Tab>
    <Tab value="pnpm">```bash pnpm add @singularity-payments/fastify ```</Tab>
    <Tab value="yarn">```bash yarn add @singularity-payments/fastify ```</Tab>
    <Tab value="bun">```bash bun add @singularity-payments/fastify ```</Tab>
  </Tabs>
</Tab>

  <Tab value="Hono">
    <Tabs items={["npm", "pnpm", "yarn", "bun"]}>
      <Tab value="npm">
```bash
npm install @singularity-payments/hono
```
      </Tab>
      <Tab value="pnpm">
```bash
pnpm add @singularity-payments/hono
```
      </Tab>
      <Tab value="yarn">
```bash
yarn add @singularity-payments/hono
```
      </Tab>
      <Tab value="bun">
```bash
bun add @singularity-payments/hono
```
      </Tab>
    </Tabs>
  </Tab>
</Tabs>
## Client-Side

<Callout type="warn" title="Security Warning">
  Client-side packages require a backend server. Never expose M-Pesa credentials
  in client-side code, these packages are designed to simplify integration with
  the backend
</Callout>

<Tabs items={["React", "Vue", "Svelte"]}>
  <Tab value="React">
    <Tabs items={["npm", "pnpm", "yarn", "bun"]}>
      <Tab value="npm">
```bash
npm install @singularity-payments/react
```
      </Tab>
      <Tab value="pnpm">
```bash
pnpm add @singularity-payments/react
```
      </Tab>
      <Tab value="yarn">
```bash
yarn add @singularity-payments/react
```
      </Tab>
      <Tab value="bun">
```bash
bun add @singularity-payments/react
```
      </Tab>
    </Tabs>
  </Tab>
<Tab value="Vue">
  <Tabs items={["npm", "pnpm", "yarn", "bun"]}>
    <Tab value="npm">
```bash
npm install @singularity-payments/vue
```
    </Tab>
    <Tab value="pnpm">
```bash
pnpm add @singularity-payments/vue
```
    </Tab>
    <Tab value="yarn">
```bash
yarn add @singularity-payments/vue
```
    </Tab>
    <Tab value="bun">
```bash
bun add @singularity-payments/vue
```
    </Tab>
  </Tabs>
</Tab>

  <Tab value="Svelte">
    <Tabs items={["npm", "pnpm", "yarn", "bun"]}>
      <Tab value="npm">
```bash
npm install @singularity-payments/svelte
```
      </Tab>
      <Tab value="pnpm">
```bash
pnpm add @singularity-payments/svelte
```
      </Tab>
      <Tab value="yarn">
```bash
yarn add @singularity-payments/svelte
```
      </Tab>
      <Tab value="bun">
```bash
bun add @singularity-payments/svelte
```
      </Tab>
    </Tabs>
  </Tab>
</Tabs>

## Setup Ngrok for Testing

M-Pesa requires a public callback URL to send payment notifications. For local development, use ngrok:

<Steps>
<Step>

Install ngrok from [ngrok.com](https://ngrok.com)
or using a node package manager:

    <Tabs items={["npm", "pnpm", "yarn", "bun"]}>
      <Tab value="npm">

```bash
npm install -g ngrok
```

      </Tab>
      <Tab value="pnpm">

```bash
pnpm add -g ngrok
```

      </Tab>
      <Tab value="yarn">

```bash
yarn global add ngrok
```

      </Tab>
      <Tab value="bun">

```bash
bun add -g ngrok
```

      </Tab>
    </Tabs>

</Step>
<Step>

Start ngrok on your dev port:

```bash
ngrok http 3000
```

</Step>
<Step>

Copy the forwarding URL (e.g., `https://abc123.ngrok-free.app`)

</Step>
</Steps>

<Callout type="warn">
  Keep ngrok running while testing. M-Pesa callbacks will fail without it.
</Callout>

## Environment Setup

Create a `.env.local` file in your project root:

```bash title=".env.local"
MPESA_CONSUMER_KEY=your_consumer_key
MPESA_CONSUMER_SECRET=your_consumer_secret
MPESA_SHORTCODE=your_shortcode
MPESA_PASSKEY=your_passkey
MPESA_ENVIRONMENT=sandbox
NEXT_PUBLIC_APP_URL=https://your-ngrok-url.ngrok-free.app
```

<Callout type="warn">
  Never commit your .env file to version control. Add it to .gitignore.
</Callout>

## Configure M-Pesa Client

Create a server configuration file:

<Tabs items={["Next.js", "SvelteKit", "Nuxt", "Elysia", "Express", "Fastify", "Hono"]}>
  <Tab value="Next.js">
```typescript
import { createMpesa } from "@singularity-payments/nextjs";

export const mpesa = createMpesa(
  {
    consumerKey: process.env.MPESA_CONSUMER_KEY!,
    consumerSecret: process.env.MPESA_CONSUMER_SECRET!,
    passkey: process.env.MPESA_PASSKEY!,
    shortcode: process.env.MPESA_SHORTCODE!,
    environment:
      (process.env.MPESA_ENVIRONMENT as "sandbox" | "production") || "sandbox",
    callbackUrl: `${process.env.NEXT_PUBLIC_APP_URL}/api/mpesa/callback`,
  },
  {
    callbackOptions: {
      onSuccess: async (data) => {
        console.log("Payment successful:", data);
      },
      onFailure: async (data) => {
        console.log("Payment failed:", data);
      },
    },
  },
);
```
  </Tab>

  <Tab value="SvelteKit">
```typescript
import { createMpesa } from '@singularity-payments/sveltekit';
import {
  MPESA_CONSUMER_KEY,
  MPESA_CONSUMER_SECRET,
  MPESA_PASSKEY,
  MPESA_SHORTCODE
} from '$env/static/private';

export const mpesa = createMpesa(
  {
    consumerKey: MPESA_CONSUMER_KEY,
    consumerSecret: MPESA_CONSUMER_SECRET,
    passkey: MPESA_PASSKEY,
    shortcode: MPESA_SHORTCODE,
    environment: 'sandbox',
    callbackUrl: `https://your-domain.ngrok-free.dev/api/mpesa/callback`
  },
  {
    callbackOptions: {
      onSuccess: async (data) => {
        console.log('Payment successful:', data);
      },
      onFailure: async (data) => {
        console.log('Payment failed:', data);
      }
    }
  }
);
```
  </Tab>

  <Tab value="Nuxt">
```typescript
import { createMpesa } from "@singularity-payments/nuxt";

const config = useRuntimeConfig();

export const mpesa = createMpesa(
  {
    consumerKey: config.mpesaConsumerKey,
    consumerSecret: config.mpesaConsumerSecret,
    passkey: config.mpesaPasskey,
    shortcode: config.mpesaShortcode,
    environment: "sandbox",
    callbackUrl: `https://your-domain.ngrok-free.dev/api/mpesa/callback`,
  },
  {
    callbackOptions: {
      onSuccess: async (data) => {
        console.log("Payment successful:", data);
      },
      onFailure: async (data) => {
        console.log("Payment failed:", data);
      },
    },
  },
);
```
  </Tab>

  <Tab value="Elysia">
```typescript
import { Elysia } from "elysia";
import { cors } from "@elysiajs/cors";
import { createMpesa } from "@singularity-payments/elysia";

const mpesa = createMpesa({
consumerKey: process.env.MPESA_CONSUMER_KEY!,
consumerSecret: process.env.MPESA_CONSUMER_SECRET!,
passkey: process.env.MPESA_PASSKEY!,
shortcode: process.env.MPESA_SHORTCODE!,
environment: "sandbox",
callbackUrl: `https://your-domain.ngrok-free.dev/api/mpesa/callback`,
});

const app = new Elysia()
.use(
cors({
origin: "http://localhost:3000",
credentials: true,
allowedHeaders: ["Content-Type", "Authorization"],
methods: ["GET", "POST", "OPTIONS"],
}),
)
.get("/", () => "M-Pesa Payment API")
.get("/health", () => ({ status: "ok" }))
.group("/api", (app) => app.use(mpesa.app))
.listen(3004);

console.log("Registered routes:");
app.routes.forEach((route) => {
console.log(`${route.method} ${route.path}`);
});

console.log(
`Elysia is running at ${app.server?.hostname}:${app.server?.port}`,
);

````
  </Tab>

  <Tab value="Express">
```typescript
import "dotenv/config";
import express from "express";
import cors from "cors";
import { createMpesa } from "@singularity-payments/express";

const app = express();

app.use(
  cors({
    origin: ["http://localhost:3000", "http://localhost:3001"],
    credentials: true,
    methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS", "PATCH"],
    allowedHeaders: ["Content-Type", "Authorization", "X-Requested-With"],
    preflightContinue: false,
    optionsSuccessStatus: 204,
  }),
);

app.use(express.json());
app.use(express.urlencoded({ extended: true }));

app.use((req, res, next) => {
  console.log(`${req.method} ${req.path}`, req.body);
  next();
});

const mpesa = createMpesa({
  consumerKey: process.env.MPESA_CONSUMER_KEY!,
  consumerSecret: process.env.MPESA_CONSUMER_SECRET!,
  passkey: process.env.MPESA_PASSKEY!,
  shortcode: process.env.MPESA_SHORTCODE!,
  environment: "sandbox",
  callbackUrl: `https://your-domain.ngrok-free.dev/api/mpesa/callback`,
});

const mpesaRouter = express.Router();
mpesa.router(mpesaRouter);
app.use("/api/mpesa", mpesaRouter);

app.use((err, req, res, next) => {
  console.error("Error:", err);
  res.status(500).json({
    success: false,
    error: err.message || "Internal server error",
  });
});

app.listen(3001, () => {
  console.log("Server running on port 3001");
  console.log("Environment variables loaded:", {
    hasConsumerKey: !!process.env.MPESA_CONSUMER_KEY,
    hasConsumerSecret: !!process.env.MPESA_CONSUMER_SECRET,
    hasPasskey: !!process.env.MPESA_PASSKEY,
    hasShortcode: !!process.env.MPESA_SHORTCODE,
  });
});
````

  </Tab>

  <Tab value="Fastify">
```typescript
import Fastify from "fastify";
import cors from "@fastify/cors";
import { config } from "dotenv";
import { createMpesa } from "@singularity-payments/fastify";

config();

const fastify = Fastify({
logger: true,
});

fastify.register(cors, {
origin: "http://localhost:3000",
credentials: true,
});

const mpesa = createMpesa({
consumerKey: process.env.MPESA_CONSUMER_KEY!,
consumerSecret: process.env.MPESA_CONSUMER_SECRET!,
passkey: process.env.MPESA_PASSKEY!,
shortcode: process.env.MPESA_SHORTCODE!,
environment: "sandbox",
callbackUrl: `https://your-domain.ngrok-free.dev/api/mpesa/callback`,
});

fastify.register(
async (instance) => {
mpesa.router(instance);
},
{ prefix: "/api/mpesa" },
);

const start = async () => {
try {
await fastify.listen({ port: 3003, host: "0.0.0.0" });
console.log("Server running on port 3003");
} catch (err) {
fastify.log.error(err);
process.exit(1);
}
};

start();

````
  </Tab>

  <Tab value="Hono">
```typescript
import { Hono } from "hono";
import { serve } from "@hono/node-server";
import { config } from "dotenv";
import { createMpesa } from "@singularity-payments/hono";
import { cors } from "hono/cors";

config();

const app = new Hono();

app.use("/api/*", cors());
app.use(
  "/api/*",
  cors({
    origin: "http://localhost:3000",
    allowHeaders: ["X-Custom-Header", "Upgrade-Insecure-Requests"],
    allowMethods: ["POST", "GET", "OPTIONS"],
    exposeHeaders: ["Content-Length", "X-Kuma-Revision"],
    maxAge: 600,
    credentials: true,
  }),
);

const mpesa = createMpesa({
  consumerKey: process.env.MPESA_CONSUMER_KEY!,
  consumerSecret: process.env.MPESA_CONSUMER_SECRET!,
  passkey: process.env.MPESA_PASSKEY!,
  shortcode: process.env.MPESA_SHORTCODE!,
  environment: "sandbox",
  callbackUrl: `https://your-domain.ngrok-free.dev/api/mpesa/callback`,
});

app.route("/api/mpesa", mpesa.app);

serve({
  fetch: app.fetch,
  port: 3002,
});

console.log("Server running on port 3002");
````

  </Tab>
</Tabs>

## Create API Route ( Only for Next.js SvelteKit, Nuxt.js)

Create a catch-all API route to handle all M-Pesa operations.
This only applies to:

- SvelteKit
- Next.js
- Nuxt.js

```typescript title="app/api/mpesa/[...mpesa]/route.ts"
import { mpesa } from "~/lib/mpesa";

export const { POST } = mpesa.handlers.catchAll;
```

This single route handles all M-Pesa operations including callbacks, payment initiation, and status queries.

## Create Payment Form

Create a client component for handling payments:

```tsx title="components/payment-form.tsx"
"use client";

import { useState } from "react";
import { useMpesaPayment, usePaymentStatus } from "@singularity-payments/react";

export function PaymentForm() {
  const [amount, setAmount] = useState("100");
  const [phoneNumber, setPhoneNumber] = useState("254712345678");

  const { initiatePayment, state, CheckoutRequestID, error, reset } =
    useMpesaPayment();
  const { status, isSuccess, isFailed } = usePaymentStatus({
    CheckoutRequestID,
  });

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    await initiatePayment({
      amount: Number(amount),
      phoneNumber,
      accountReference: "ORDER001",
      transactionDesc: "Payment",
    });
  };

  if (isSuccess) {
    return (
      <div className="mx-auto max-w-md rounded-lg border border-green-600 bg-green-50 p-6 dark:border-green-400 dark:bg-green-950">
        <h3 className="mb-2 text-lg font-semibold text-green-900 dark:text-green-100">
          Payment Successful
        </h3>
        <p className="mb-4 text-sm text-green-800 dark:text-green-200">
          {status?.ResultDesc}
        </p>
        <button
          onClick={reset}
          className="w-full rounded-md border border-green-600 bg-transparent px-4 py-2 text-green-900 hover:bg-green-100 dark:border-green-400 dark:text-green-100 dark:hover:bg-green-900"
        >
          Make Another Payment
        </button>
      </div>
    );
  }

  if (isFailed && status) {
    return (
      <div className="mx-auto max-w-md rounded-lg border border-red-600 bg-red-50 p-6 dark:border-red-400 dark:bg-red-950">
        <h3 className="mb-2 text-lg font-semibold text-red-900 dark:text-red-100">
          Payment Failed
        </h3>
        <p className="mb-4 text-sm text-red-800 dark:text-red-200">
          {status.ResultDesc}
        </p>
        <button
          onClick={reset}
          className="w-full rounded-md border border-red-600 bg-transparent px-4 py-2 text-red-900 hover:bg-red-100 dark:border-red-400 dark:text-red-100 dark:hover:bg-red-900"
        >
          Try Again
        </button>
      </div>
    );
  }

  return (
    <div className="mx-auto max-w-md rounded-lg border p-6">
      <h2 className="mb-6 text-2xl font-bold">M-Pesa Payment</h2>

      <form onSubmit={handleSubmit} className="space-y-4">
        <div>
          <label className="mb-2 block text-sm font-medium">Amount (KES)</label>
          <input
            type="number"
            value={amount}
            onChange={(e) => setAmount(e.target.value)}
            min="1"
            required
            disabled={state !== "idle"}
            className="w-full rounded-md border px-3 py-2"
          />
        </div>

        <div>
          <label className="mb-2 block text-sm font-medium">Phone Number</label>
          <input
            type="tel"
            value={phoneNumber}
            onChange={(e) => setPhoneNumber(e.target.value)}
            placeholder="254712345678"
            required
            disabled={state !== "idle"}
            className="w-full rounded-md border px-3 py-2"
          />
        </div>

        <button
          type="submit"
          disabled={state !== "idle"}
          className="w-full rounded-md bg-primary px-4 py-2 text-primary-foreground hover:bg-primary/90 disabled:opacity-50"
        >
          {state === "initiating" && "Processing..."}
          {state === "pending" && "Check Your Phone"}
          {state === "idle" && "Pay with M-Pesa"}
        </button>
      </form>

      {error && (
        <div className="mt-4 rounded-md border border-red-600 bg-red-50 p-3 dark:border-red-400 dark:bg-red-950">
          <p className="text-sm text-red-800 dark:text-red-200">
            {error.message}
          </p>
        </div>
      )}
    </div>
  );
}
```

## Use in Your Page

Import and use the payment form in any page:

```tsx title="app/page.tsx"
import { PaymentForm } from "~/components/payment-form";

export default function Home() {
  return (
    <main className="flex min-h-screen items-center justify-center">
      <PaymentForm />
    </main>
  );
}
```

## Test Your Integration

<Steps>
<Step>

Start your development server

```bash
npm run dev
```

</Step>
<Step>

Start ngrok in another terminal

```bash
ngrok http 3000
```

</Step>
<Step>

Update your `.env.local` with the ngrok URL and restart your dev server

</Step>
<Step>

Navigate to your page with the payment form

</Step>
<Step>

Enter a test amount and phone number

</Step>
<Step>

Click Pay with M-Pesa and check your phone for the STK Push prompt

</Step>
<Step>

Enter your M-Pesa PIN to complete the payment

</Step>
</Steps>

<Callout type="info">
  In sandbox mode, use the test credentials provided by Safaricom Daraja.
</Callout>

## What's Next

- Learn about [Configuration Options](/docs/getting-started/configuration)
- Explore [API Reference](/docs/api)
